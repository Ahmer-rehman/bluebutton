#!/bin/bash -e

bbb_config() {
	
	if id meteor > /dev/null 2>&1 ; then
		if [ -d /var/log/bigbluebutton/html5 ]; then
			chown -R meteor:meteor /var/log/bigbluebutton/html5
		fi
	fi

  if [[ ! -L /usr/share/bbb-web/logs && -d /usr/share/bbb-web/logs ]]; then  # remove old directory (if exists)
    rm -rf /usr/share/bbb-web/logs
  fi

  if [ ! -L /usr/share/bbb-web/logs ]; then  # create symbolic link
    ln -s /var/log/bigbluebutton /usr/share/bbb-web/logs
  fi
  chown bigbluebutton:bigbluebutton /var/log/bigbluebutton
  touch /var/log/bigbluebutton/bbb-web.log
  chown bigbluebutton:bigbluebutton /var/log/bigbluebutton/bbb-web.log

  update-java-alternatives -s java-1.11.0-openjdk-amd64

  # Restart bbb-web to deploy new 
  startService bbb-web.service || echo "bbb-web.service could not be registered or started"
}

case "$1" in
  configure|upgrade|1|2)
  	bbb_config
    ;;

    abort-upgrade|abort-remove|abort-deconfigure)

    ;;

    *)
      echo "## postinst called with unknown argument \`$1'" >&2
    ;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

exit 0
