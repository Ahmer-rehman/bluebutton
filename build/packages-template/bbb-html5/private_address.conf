# Map public IPv4 address   -> 0
#     private IPv4 address  -> 1
#     IPv6 address          -> 2

geo $private_address {
  10.0.0.0/8       1;
  172.16.0.0/12    1;
  192.168.0.0/16   1;
  169.254.0.0/16   1;
  100.64.0.0/10    1;
  0.0.0.0/0        0;
  ::/0             2;

  # Support reverse proxies.
  #
  # If we receive a proxy connection from a private address, base our
  # $private_address calculation on the X-Forwarded-For address, since
  # this is a proxy on our private network and we want to negotiate
  # ICE candidates based on its client's address.  If the proxy is on
  # the public Internet, we want to negotiate ICE candidates based on
  # the proxy's address, not its client's.

  proxy            10.0.0.0/8;
  proxy            172.16.0.0/12;
  proxy            192.168.0.0/16;
  proxy            169.254.0.0/16;
  proxy            100.64.0.0/10;
}
