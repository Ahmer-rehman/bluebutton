<!-- SIP clients send FreeSWITCH a list of their IP addresses, from which -->
<!-- one address will be selected for use.  Which one depends on how the client -->
<!-- connected - connections from a private address space should use -->
<!-- the private address; connections from a public address should use -->
<!-- the public address.  Since BigBlueButton runs SIP through nginx as a proxy, -->
<!-- FreeSWITCH can't determine on its own how the client connected. -->

<!-- Therefore, two different FreeSWITCH profiles are used, listening on -->
<!-- different TCP ports for connections from localhost's nginx. -->

<!-- This is the "private" profile, listening for WS on port 5068 -->
<!-- and WSS on port 7445, used for connections from private IP addresses. -->

<!-- apply-candidate-acl prefers private IP addresses (rfc1918) -->
<!-- ext-rtp-ip and ext-sip-ip are set to this server's private address -->
<!-- local-network-acl is set to localnet.auto (local network is local; everything else is NAT) -->

<profile name="private">

  <domains>
    <domain name="all" alias="false" parse="true"/>
  </domains>

  <settings>
    <X-PRE-PROCESS cmd="include" data="common.xml"/>

    <!-- Unused by BBB, but FreeSWITCH won't run unless its specified -->
    <param name="sip-port" value="5062"/>

    <!-- local-network-acl is used to determine if NAT is in use -->
    <!-- Due to nginx proxy, connection will always come from loopback, this will match, no NAT -->
    <param name="local-network-acl" value="loopback"/>

    <param name="apply-candidate-acl" value="localnet.auto"/>
    <param name="apply-candidate-acl" value="rfc1918.auto"/>
    <param name="apply-candidate-acl" value="any_v4.auto"/>

    <!--
        DO NOT USE HOSTNAMES, ONLY IP ADDRESSES IN THESE SETTINGS!
    -->

    <param name="rtp-ip" value="$${local_ip_v4}"/>
    <param name="sip-ip" value="$${local_ip_v4}"/>
    <param name="ext-rtp-ip" value="$${local_ip_v4}"/>
    <param name="ext-sip-ip" value="$${local_ip_v4}"/>

    <param name="ws-binding"  value="127.0.0.1:5068"/>
    <param name="wss-binding"  value="127.0.0.1:7445"/>

  </settings>
</profile>
